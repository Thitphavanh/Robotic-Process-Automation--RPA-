import pyautogui
import webbrowser
import time
import platform
import os
from urllib.parse import quote_plus
from PIL import ImageGrab

# --- 1. р╕Бр╕│р╕лр╕Щр╕Фр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ ---
search_term = 'р╕гр╕▓р╕Др╕▓р╕лр╕╕р╣Йр╕Щр╣Др╕Чр╕вр╕зр╕▒р╕Щр╕Щр╕╡р╣Й'

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ър╕Ыр╕Пр╕┤р╕Ър╕▒р╕Хр╕┤р╕Бр╕▓р╕г
is_mac = platform.system() == 'Darwin'
cmd_key = 'command' if is_mac else 'ctrl'

print(f'р╕гр╕░р╕Ър╕Ър╕Ыр╕Пр╕┤р╕Ър╕▒р╕Хр╕┤р╕Бр╕▓р╕г: {"macOS" if is_mac else "Windows/Linux"}')

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ permissions р╕Ър╕Щ macOS
if is_mac:
    print('\nтЪая╕П  р╕кр╕│р╕Др╕▒р╕Нр╕кр╕│р╕лр╕гр╕▒р╕Ъ macOS:')
    print('р╕Хр╣Йр╕нр╕Зр╕нр╕Щр╕╕р╕Нр╕▓р╕Х Screen Recording р╕кр╕│р╕лр╕гр╕▒р╕Ъ Terminal/Python:')
    print('System Preferences > Security & Privacy > Privacy > Screen Recording')
    print('тЬУ р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Terminal р╕лр╕гр╕╖р╕н Python\n')

print('р╕Ър╕нр╕Чр╕Ир╕░р╣Ар╕гр╕┤р╣Ир╕бр╕Чр╕│р╕Зр╕▓р╕Щр╣Гр╕Щ 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡... р╕Бр╕гр╕╕р╕Ур╕▓р╕нр╕вр╣Ир╕▓р╕Вр╕вр╕▒р╕Ър╣Ар╕бр╕▓р╕кр╣Мр╣Бр╕ер╕░р╕Др╕╡р╕вр╣Мр╕Ър╕нр╕гр╣Мр╕Ф')
time.sleep(5) # р╕лр╕Щр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓ 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Ар╕гр╕▓р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Хр╕▒р╕з

# --- 2. р╕кр╕гр╣Йр╕▓р╕З Google Search URL р╕Юр╕гр╣Йр╕нр╕б encode р╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в ---
print(f'р╕Бр╕│р╕ер╕▒р╕Зр╕Др╣Йр╕Щр╕лр╕▓р╕Др╕│р╕зр╣Ир╕▓: {search_term}')
# Encode р╕Др╕│р╕Др╣Йр╕Щр╕лр╕▓р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ URL-safe format
encoded_search = quote_plus(search_term)
search_url = f'https://www.google.com/search?q={encoded_search}'
print(f'URL: {search_url}')

# --- 3. р╣Ар╕Ыр╕┤р╕Фр╣Ар╕зр╣Зр╕Ър╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣Мр╕Юр╕гр╣Йр╕нр╕б Search URL ---
print('р╕Бр╕│р╕ер╕▒р╕Зр╣Ар╕Ыр╕┤р╕Фр╣Ар╕зр╣Зр╕Ър╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣Мр╣Бр╕ер╕░р╕Др╣Йр╕Щр╕лр╕▓...')
webbrowser.open(search_url)
time.sleep(7) # р╕гр╕нр╣Гр╕лр╣Йр╕лр╕Щр╣Йр╕▓р╕Ьр╕ер╕Бр╕▓р╕гр╕Др╣Йр╕Щр╕лр╕▓р╣Вр╕лр╕ер╕Ф

# --- 4. р╕Цр╣Ир╕▓р╕вр╕ар╕▓р╕Юр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Ар╕Юр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М ---
print('р╕Бр╕│р╕ер╕▒р╕Зр╕Цр╣Ир╕▓р╕вр╕ар╕▓р╕Юр╕лр╕Щр╣Йр╕▓р╕Ир╕н...')
filename = 'stock_price_result.png'

try:
    # р╕ер╕нр╕Зр╣Гр╕Кр╣Й pyautogui р╕Бр╣Ир╕нр╕Щ
    screenshot = pyautogui.screenshot()
    screenshot.save(filename)
    print(f'тЬЕ р╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕Бр╕▓р╕гр╕Др╣Йр╕Щр╕лр╕▓р╣Ар╕Ыр╣Зр╕Щр╣Др╕Яр╕ер╣Мр╕Кр╕╖р╣Ир╕н {filename}')

    # р╣Бр╕кр╕Фр╕Зр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Др╕Яр╕ер╣М
    full_path = os.path.abspath(filename)
    print(f'ЁЯУБ р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Др╕Яр╕ер╣М: {full_path}')

except Exception as e:
    print(f'тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Цр╣Ир╕▓р╕вр╕ар╕▓р╕Юр╕лр╕Щр╣Йр╕▓р╕Ир╕н: {e}')

    if is_mac:
        print('\nЁЯФз р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕Вр╕Ър╕Щ macOS:')
        print('1. р╣Ар╕Ыр╕┤р╕Ф System Preferences (р╕лр╕гр╕╖р╕н System Settings)')
        print('2. р╣Др╕Ыр╕Чр╕╡р╣И Security & Privacy > Privacy')
        print('3. р╣Ар╕ер╕╖р╕нр╕Б "Screen Recording" р╕Ир╕▓р╕Бр╣Ар╕бр╕Щр╕╣р╕Фр╣Йр╕▓р╕Щр╕Лр╣Йр╕▓р╕в')
        print('4. р╕Др╕ер╕┤р╕Б ЁЯФТ р╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Д (р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ)')
        print('5. тЬУ р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Terminal р╕лр╕гр╕╖р╕н Python')
        print('6. р╕гр╕╡р╕кр╕Хр╕▓р╕гр╣Мр╕Ч Terminal р╣Бр╕ер╣Йр╕зр╕гр╕▒р╕Щр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З')
        print('\nр╕лр╕гр╕╖р╕нр╣Гр╕Кр╣Йр╕Др╕│р╕кр╕▒р╣Ир╕З: Command + Shift + 5 р╣Ар╕Юр╕╖р╣Ир╕нр╕Цр╣Ир╕▓р╕вр╕ар╕▓р╕Юр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕З')
    else:
        print('\nЁЯФз р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Pillow р╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З')
        print('р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╕Фр╣Йр╕зр╕вр╕Др╕│р╕кр╕▒р╣Ир╕З: pip install Pillow')